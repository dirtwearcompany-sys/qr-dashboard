<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>QR Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
body { font-family: Arial; max-width: 900px; margin:auto; padding:20px }
input, button { padding:8px; margin:5px; width:300px }
.qr-item { display:flex; border:1px solid #ccc; padding:10px; margin-bottom:10px }
.qr-info { margin-left:20px }
button { cursor:pointer }
.delete { background:red; color:white; border:none }
.download { background:green; color:white; border:none; margin-left:5px }
</style>
</head>

<body>
<h1>QR Dashboard</h1>

<div id="dashboard">
  <h2>Create QR</h2>
  <input id="label" placeholder="Label"><br>
  <input id="url" placeholder="https://example.com"><br>
  <button id="createBtn">Create QR</button>

  <h2>All QR Codes</h2>
  <div id="qrList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¥ Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDPfjv3ZZ18ELPiC2Jc-z_yk86ejOvAad4",
  authDomain: "qr-tracker-4b53e.firebaseapp.com",
  projectId: "qr-tracker-4b53e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const qrRef = collection(db, "qrcodes");

// MUST MATCH YOUR scan.html URL
const baseURL = "https://dirtwearcompany-sys.github.io/qr-dashboard/scan.html";

// CREATE QR
createBtn.onclick = async () => {
  const labelVal = label.value.trim();
  const urlVal = url.value.trim();
  if (!labelVal || !urlVal) return alert("Enter label and URL");

  await addDoc(qrRef, { label: labelVal, url: urlVal, scans: 0, daily:{} });
  label.value = "";
  url.value = "";
};

// DELETE QR
async function removeQR(id){
  if(confirm("Delete this QR code?")){
    await deleteDoc(doc(db, "qrcodes", id));
  }
}

// DOWNLOAD QR
function downloadQR(canvas, name){
  const a = document.createElement("a");
  a.href = canvas.toDataURL();
  a.download = `${name}.png`;
  a.click();
}

// DISPLAY QR CODES
onSnapshot(qrRef, snap => {
  qrList.innerHTML = "";
  snap.forEach(d => {
    const data = d.data();
    const row = document.createElement("div");
    row.className = "qr-item";

    const box = document.createElement("div");
    new QRCode(box, {
      text: `${baseURL}?id=${d.id}`,
      width:120,
      height:120
    });

    const info = document.createElement("div");
    info.className = "qr-info";
    info.innerHTML = `
      <b>${data.label}</b><br>
      Total scans: ${data.scans}<br>
      <pre>${JSON.stringify(data.daily || {}, null, 2)}</pre>
    `;

    const del = document.createElement("button");
    del.textContent = "Delete";
    del.className = "delete";
    del.onclick = () => removeQR(d.id);

    const dl = document.createElement("button");
    dl.textContent = "Download";
    dl.className = "download";
    dl.onclick = () => downloadQR(box.querySelector("canvas"), data.label);

    info.appendChild(del);
    info.appendChild(dl);
    row.appendChild(box);
    row.appendChild(info);
    qrList.appendChild(row);
  });
});
</script>
</body>
</html>
