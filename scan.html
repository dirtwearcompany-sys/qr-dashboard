<meta charset="UTF-8">
<title>QR Redirect</title>
<style>
body { font-family:Arial,sans-serif; background:#f4f4f4; display:flex; justify-content:center; align-items:center; height:100vh; text-align:center; }
body { font-family: Arial,sans-serif; background:#f4f4f4; display:flex; justify-content:center; align-items:center; height:100vh; text-align:center; }
.container { background:white; padding:30px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); max-width:400px; }
h1 { color:#4CAF50; }
p { font-size:18px; }
@@ -13,15 +13,17 @@
</head>
<body>
<div class="container">
<h1>Redirecting...</h1>
<p id="message">Please wait while we redirect you.</p>
<p id="countdown"></p>
<p id="fallback" style="display:none;">If not redirected, <a id="redirectLink" href="#">click here</a>.</p>
  <h1>Redirecting...</h1>
  <p id="message">Please wait while we redirect you.</p>
  <p id="countdown"></p>
  <p id="fallback" style="display:none;">If not redirected, <a id="redirectLink" href="#">click here</a>.</p>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// ---------------------- FIREBASE CONFIG ----------------------
const firebaseConfig = {
apiKey: "AIzaSyDPfjv3ZZ18ELPiC2Jc-z_yk86ejOvAad4",
authDomain: "qr-tracker-4b53e.firebaseapp.com",
@@ -33,50 +35,50 @@ <h1>Redirecting...</h1>
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Get QR ID from URL
// ---------------------- GET QR ID ----------------------
const params = new URLSearchParams(window.location.search);
const id = params.get('id');

if (!id) {
document.getElementById('message').textContent = "Invalid QR Code";
} else {
  db.collection('qrcodes').doc(id).get()
    .then(doc => {
      if (!doc.exists) {
        document.getElementById('message').textContent = "QR Code not found.";
        return;
      }
      const data = doc.data();
  const docRef = db.collection('qrcodes').doc(id);
  
  docRef.get().then(doc => {
    if (!doc.exists) {
      document.getElementById('message').textContent = "QR Code not found.";
      return;
    }

    const data = doc.data();

      // Increment scans
      db.collection('qrcodes').doc(id).update({
        scans: firebase.firestore.FieldValue.increment(1)
      }).catch(console.error);
    // ---------------------- INCREMENT SCANS ----------------------
    docRef.update({ scans: firebase.firestore.FieldValue.increment(1) }).catch(console.error);

      // Must be full URL
      const redirectUrl = data.text;
    // ---------------------- REDIRECT URL ----------------------
    const redirectUrl = data.text; // Must be full URL (http:// or https://)

    // ---------------------- COUNTDOWN REDIRECT ----------------------
    let countdown = 3;
    const countdownElem = document.getElementById('countdown');
    const interval = setInterval(() => {
      countdownElem.textContent = `Redirecting in ${countdown}...`;
      countdown--;
      if (countdown < 0) {
        clearInterval(interval);
        window.location.href = redirectUrl;
      }
    }, 1000);

      // Countdown redirect
      let countdown = 3;
      const countdownElem = document.getElementById('countdown');
      const interval = setInterval(() => {
        countdownElem.textContent = `Redirecting in ${countdown}...`;
        countdown--;
        if (countdown < 0) {
          clearInterval(interval);
          window.location.href = redirectUrl;
        }
      }, 1000);
    // ---------------------- FALLBACK LINK ----------------------
    const fallbackLink = document.getElementById('redirectLink');
    fallbackLink.href = redirectUrl;
    document.getElementById('fallback').style.display = 'block';

      // Fallback link
      const fallbackLink = document.getElementById('redirectLink');
      fallbackLink.href = redirectUrl;
      document.getElementById('fallback').style.display = 'block';
    })
    .catch(err => {
      document.getElementById('message').textContent = "An error occurred.";
      console.error(err);
    });
  }).catch(err => {
    document.getElementById('message').textContent = "An error occurred.";
    console.error(err);
  });
}
</script>
</body>
