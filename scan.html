<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
<p>Redirectingâ€¦</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, increment }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¥ SAME CONFIG AS index.html
const firebaseConfig = {
  piKey: "AIzaSyDPfjv3ZZ18ELPiC2Jc-z_yk86ejOvAad4",
  authDomain: "qr-tracker-4b53e.firebaseapp.com",
  projectId: "qr-tracker-4b53e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// GET QR ID
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = "Invalid QR code";
  throw new Error("Missing QR ID");
}

const ref = doc(db, "qrcodes", id);
const snap = await getDoc(ref);

if (!snap.exists()) {
  document.body.innerHTML = "QR code not found";
  throw new Error("QR not found");
}

// INCREMENT COUNTERS
const today = new Date().toISOString().slice(0,10);

await updateDoc(ref, {
  scans: increment(1),
  [`daily.${today}`]: increment(1)
});

// REDIRECT
window.location.href = snap.data().url;
</script>

</body>
</html>
