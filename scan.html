
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>QR Scan</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 100px; }
    h2 { color: #333; }
  </style>
</head>
<body>
<h2 id="message">Processing your scan...</h2>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, increment, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¥ Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDPfjv3ZZ18ELPiC2Jc-z_yk86ejOvAad4",
  authDomain: "qr-tracker-4b53e.firebaseapp.com",
  projectId: "qr-tracker-4b53e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Get QR code ID from URL: scan.html?id=qr123
const params = new URLSearchParams(window.location.search);
const codeId = params.get("id");

// Mapping of QR code IDs to actual destination URLs (hidden from user)
const destinations = {
  "promo1": "https://example.com/promo1",
  "promo2": "https://example.com/promo2",
  "promo3": "https://example.com/promo3"
};

const messageEl = document.getElementById("message");

if(codeId && destinations[codeId]){
  const docRef = doc(db, "qr_codes", codeId);

  // Increment scan count & log timestamp
  updateDoc(docRef, { 
    count: increment(1), 
    lastScanned: serverTimestamp()
  })
  .catch(async (err) => {
    // If doc doesn't exist, create it
    await setDoc(docRef, { count: 1, lastScanned: serverTimestamp() });
  });

  // Show thank you message
  messageEl.textContent = "Thank you for scanning! Redirecting...";

  // Redirect to hidden URL after 2 seconds
  setTimeout(() => {
    window.location.href = destinations[codeId];
  }, 2000);

} else {
  // Invalid QR code
  messageEl.textContent = "Invalid QR code.";
}
</script>
</body>
</html>

