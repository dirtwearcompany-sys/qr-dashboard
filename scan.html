<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Redirect</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<p>Redirecting...</p>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDPfjv3ZZ18ELPiC2Jc-z_yk86ejOvAad4",
  authDomain: "qr-tracker-4b53e.firebaseapp.com",
  projectId: "qr-tracker-4b53e",
  storageBucket: "qr-tracker-4b53e.firebasestorage.app",
  messagingSenderId: "329754045002",
  appId: "1:329754045002:web:922633ad6ada8018a1d4b3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const params = new URLSearchParams(window.location.search);
const id = params.get('id');

if(!id) {
  document.body.innerHTML = "Invalid QR Code";
} else {
  const docRef = db.collection('qrcodes').doc(id);
  docRef.get().then(doc => {
    if(!doc.exists) return document.body.innerHTML = "QR Code not found";
    const data = doc.data();
    docRef.update({scans: firebase.firestore.FieldValue.increment(1)});
    window.location.href = data.text; // Redirect to the original URL/text
  });
}
</script>
</body>
</html>

